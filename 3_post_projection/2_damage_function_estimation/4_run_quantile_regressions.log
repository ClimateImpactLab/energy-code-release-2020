
  ___  ____  ____  ____  ____ (R)
 /__    /   ____/   /   ____/
___/   /   /___/   /   /___/   16.1   Copyright 1985-2019 StataCorp LLC
  Statistics/Data Analysis            StataCorp
                                      4905 Lakeway Drive
     MP - Parallel Edition            College Station, Texas 77845 USA
                                      800-STATA-PC        http://www.stata.com
                                      979-696-4600        stata@stata.com
                                      979-696-4601 (fax)

Single-user 24-core Stata perpetual license:
       Serial number:  501606209668
         Licensed to:  Goldman School of Public Policy
                       University of California, Berkeley

Notes:
      1.  Stata is running in batch mode.
      2.  Unicode is supported; see help unicode_advice.
      3.  More than 2 billion observations are allowed; see help obs_advice.
      4.  Maximum number of variables is set to 5000; see help set_maxvar.

. do 4_run_quantile_regressions.do 

. *****************************************
. * Quantile regression for SCC uncertainty 
. * CALCULATION INCLUDING POST-2100 EXTRAPOLATION
. *****************************************
. /* 
> This script does the following:
>         * 1) Pulls in a .csv containing damages at global or impact region le
> vel. The .csv 
>                         should be SSP-specific, and contain damages in curren
> t year USD for every
>                         RCP-GCM-IAM-year combination. 
>         * 2) Runs a quantile regression in which the quantiles of the damage 
> function are 
>                         nonparametrically estimated for each year 't'
>                         using data only from the 5 years around 't'
>         * 3) Runs a second regression in which GMST is interacted linearly wi
> th time. 
>         * 4) Predicts quantile regression coefficients for all years 2015-230
> 0, with post-2100 extrapolation 
>                         conducted using the linear temporal interaction model
>  and pre-2100 using the nonparametric model
>         * 5) Saves a csv of quantile regression coefficients to be used by th
> e SCC uncertainty calculation derived from the FAIR 
>                         simple climate model
> */
. *****************************************************************************
> *****
. * SET UP -- Change paths and input choices to fit desired output
. *****************************************************************************
> *****
. 
. clear all

. set more off

. set scheme s1color

. 
. glob DB "/mnt"

. glob DB_data "$DB/CIL_energy/code_release_data_pixel_interaction"

. glob dir "$DB_data/projection_system_outputs/damage_function_estimation"

. 
. * Note: this code is only set up to run quantile regressions for SSP3-main mo
> del. 
. loc model = "main"

. loc ssp = "SSP3" 

. 
. ******************************************
. * Set locals based on options 
. 
. if("`model'" == "main") {
.         loc model_tag = ""
. }

. 
. * list of the scenarios we want to run a damage function for 
. if("`ssp'" == "SSP3") {
.         loc pricelist price014 price0 price03 WITCHGLOBIOM42 MERGEETL60 REMIN
> DMAgPIE1730 REMIND17CEMICS REMIND17
. }

. 
. * Get a list of the quantiles we want to run the quantile regression for 
. forvalues pp = 5(5)95 {
  2.         di "`pp'"
  3.         loc p = `pp'/100
  4.         loc quantiles_to_eval "`quantiles_to_eval' `p'"
  5. }
5
10
15
20
25
30
35
40
45
50
55
60
65
70
75
80
85
90
95

. di "`quantiles_to_eval'"
 .05 .1 .15 .2 .25 .3 .35 .4 .45 .5 .55 .6 .65 .7 .75 .8 .85 .9 .95

. 
. *****************************************************************************
> *****
. * STEP 1: Pull in and format randomly sampled damages csvs
. *****************************************************************************
> *****
. 
. 
. foreach price in `pricelist' {
  2.         di "`price'"
  3.         import delim "$dir/resampled_data/gcm_damages_OTHERIND_total_energ
> y_`price'_`ssp'`model_tag'-100-draws.csv", clear case(preserve)
  4.         keep rcp year gcm iam `price'value batch
  5.         ren `price'value `price'
  6.         tempfile `price'
  7.         save ``price'', replace 
  8. }
price014
(7 vars, 1,170,000 obs)
(note: file /tmp/St249800.000001 not found)
file /tmp/St249800.000001 saved
price0
(7 vars, 1,170,000 obs)
(note: file /tmp/St249800.000002 not found)
file /tmp/St249800.000002 saved
price03
